<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Primal4k-2025-1">
    <link rel="icon" href="/lovable-uploads/3896f961-2f23-4243-86dc-f164bdc87c87.png" type="image/png">
    <link rel="apple-touch-icon" href="/lovable-uploads/3896f961-2f23-4243-86dc-f164bdc87c87.png">
    <link rel="manifest" href="/app-manifest.json">
    <meta name="theme-color" content="#FF0000">
    <title>Primal4k-2025-1</title>
    <meta name="description" content="Primal4K Radio - Your ultimate destination for premium electronic music and DJ sets" />
    <meta name="author" content="Primal4K Radio" />

    <meta property="og:title" content="Primal4K Radio App" />
    <meta property="og:description" content="Primal4K Radio - Your ultimate destination for premium electronic music and DJ sets" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    
    <style>
      body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        background: #000;
      }
      
      #app-frame {
        width: 100%;
        height: 100vh;
        border: none;
        display: block;
      }
      
      .loading {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: #ff0000;
        font-family: Arial, sans-serif;
        font-size: 18px;
        z-index: 1000;
        text-align: center;
      }
      
      .install-prompt {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #ff0000;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        cursor: pointer;
        z-index: 2000;
        display: none;
        box-shadow: 0 4px 12px rgba(255,0,0,0.4);
      }
      
      .install-prompt:hover {
        background: #cc0000;
      }
    </style>
  </head>

  <body>
    <div class="loading">
      🎵 Loading Primal4k-2025-1...<br>
      <small>Complete radio experience</small>
    </div>
    
    <div class="install-prompt" id="install-btn">
      📱 Install App
    </div>
    
      <iframe 
        id="app-frame"
        src="https://primal4k.com?source=pwa&forceHideBadge=true"
        allow="autoplay; microphone; camera; display-capture; fullscreen">
      </iframe>

    <script>
      console.log('🔧 PWA Script Loading - Android Chrome Detection');
      console.log('📱 User Agent:', navigator.userAgent);
      console.log('🌐 Current URL:', window.location.href);
      
      // Service Worker registration for PWA
      if ('serviceWorker' in navigator) {
        console.log('✅ Service Worker supported');
        navigator.serviceWorker.register('/app-sw.js')
          .then(registration => {
            console.log('✅ Primal4k Service Worker Registered', registration);
            console.log('📱 PWA ready for installation');
          })
          .catch(err => {
            console.error('❌ SW Registration Failed:', err);
          });
      } else {
        console.log('❌ Service Worker not supported');
      }

      // Handle install prompt
      let deferredPrompt;
      const installBtn = document.getElementById('install-btn');
      
      console.log('🔘 Install button element:', installBtn);

      // Check if already installed
      if (window.navigator.standalone === true) {
        console.log('📱 Already installed as PWA');
        installBtn.style.display = 'none';
      }

      // Android Chrome install prompt
      window.addEventListener('beforeinstallprompt', (e) => {
        console.log('🎯 ANDROID: beforeinstallprompt event fired!');
        console.log('📱 Install prompt available for Android Chrome');
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'block';
        installBtn.style.backgroundColor = '#00ff00'; // Green to show it's ready
        console.log('✅ Install button now visible and ready');
      });

      installBtn.addEventListener('click', async () => {
        console.log('🔘 Install button clicked');
        if (deferredPrompt) {
          console.log('📱 Showing install prompt');
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`👤 User response to install prompt: ${outcome}`);
          if (outcome === 'accepted') {
            console.log('🎉 User accepted the install prompt');
          } else {
            console.log('❌ User dismissed the install prompt');
          }
          deferredPrompt = null;
          installBtn.style.display = 'none';
        } else {
          console.log('❌ No deferred prompt available');
          console.log('💡 Manual installation: Chrome Menu → Add to Home Screen');
        }
      });

      // Handle successful installation
      window.addEventListener('appinstalled', () => {
        console.log('🎉 Primal4k App installed successfully to home screen!');
        installBtn.style.display = 'none';
        deferredPrompt = null;
      });

      // iOS Safari fallback - show install instructions
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      const isInStandaloneMode = window.navigator.standalone === true;
      
      if (isIOS && !isInStandaloneMode) {
        console.log('📱 iOS detected - manual installation required');
        setTimeout(() => {
          installBtn.style.display = 'block';
          installBtn.textContent = '📱 Add to Home Screen';
          installBtn.onclick = () => {
            alert('To install this app on iOS:\n\n1. Tap the Share button in Safari\n2. Scroll down and tap "Add to Home Screen"\n3. Tap "Add" to install');
          };
        }, 2000);
      }
      
      // Show manual install option after 5 seconds if no auto-prompt
      setTimeout(() => {
        if (!deferredPrompt && installBtn.style.display === 'none') {
          console.log('⏰ No auto-prompt after 5s - showing manual install option');
          installBtn.style.display = 'block';
          installBtn.textContent = '📱 Install App (Manual)';
          installBtn.style.backgroundColor = '#ff6600'; // Orange for manual
          installBtn.onclick = () => {
            alert('To install manually:\n\nChrome: Menu (⋮) → "Add to Home Screen"\nFirefox: Menu → "Install"\nSafari: Share → "Add to Home Screen"');
          };
        }
      }, 5000);

      // Handle iframe loading
      const iframe = document.getElementById('app-frame');
      const loading = document.querySelector('.loading');
      
      iframe.onload = () => {
        loading.style.display = 'none';
        console.log('✅ Main site loaded in app');
      };
      
      // Fallback to hide loading after 5 seconds
      setTimeout(() => {
        loading.style.display = 'none';
      }, 5000);

      // Handle app-like behavior
      window.addEventListener('load', () => {
        // Prevent context menu for app-like feel
        document.addEventListener('contextmenu', e => e.preventDefault());
        
        // Handle keyboard shortcuts for app-like experience
        document.addEventListener('keydown', (e) => {
          if (e.key === 'F12' || 
              (e.ctrlKey && e.shiftKey && e.key === 'I') ||
              (e.ctrlKey && e.shiftKey && e.key === 'C')) {
            e.preventDefault();
          }
        });
      });

      // Auto-show install button after delay if available
      setTimeout(() => {
        if (deferredPrompt) {
          installBtn.style.display = 'block';
        }
      }, 3000);
    </script>
    
    <!-- OneSignal SDK for notifications -->
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" async></script>
    <script>
      window.OneSignal = window.OneSignal || [];
      OneSignal.push(function() {
        OneSignal.init({
          appId: "d651859b-b89b-4271-83b0-d944f07d9671",
          notifyButton: { enable: true },
          allowLocalhostAsSecureOrigin: true
        });
      });
    </script>
  </body>
</html>